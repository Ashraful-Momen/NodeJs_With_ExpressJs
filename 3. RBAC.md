Perfect! Let‚Äôs build a **full Laravel-Spatie-like RBAC system in Node.js + MySQL**. This will allow an **admin to create roles, assign permissions, and assign roles to any user**, just like Spatie in Laravel.

I‚Äôll give a **Laravel-style folder structure**, **database schema**, **controllers**, **services**, and **middleware**.

---

# üìÅ Folder Structure (Laravel Style)

```
project/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ db.js                  # DB connection (Prisma/MySQL)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthController.js      # login/register
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoleController.js      # create role, assign permissions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PermissionController.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserController.js      # assign role to user
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoleService.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PermissionService.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UserService.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthMiddleware.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RoleMiddleware.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PermissionMiddleware.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ permission.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.routes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bcrypt.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ jwt.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ seed/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ app.js
‚îÇ   ‚îî‚îÄ‚îÄ server.js
‚îÇ
‚îî‚îÄ‚îÄ prisma/
    ‚îî‚îÄ‚îÄ schema.prisma
```

---

# üóÑÔ∏è Database Schema (MySQL via Prisma)

`prisma/schema.prisma`

```prisma
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  roles     UserRole[]
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String       @unique
  permissions RolePermission[]
  users       UserRole[]
}

model Permission {
  id    Int               @id @default(autoincrement())
  name  String            @unique
  roles RolePermission[]
}

model UserRole {
  id     Int @id @default(autoincrement())
  user   User @relation(fields: [userId], references: [id])
  userId Int
  role   Role @relation(fields: [roleId], references: [id])
  roleId Int
}

model RolePermission {
  id           Int        @id @default(autoincrement())
  role         Role       @relation(fields: [roleId], references: [id])
  roleId       Int
  permission   Permission @relation(fields: [permissionId], references: [id])
  permissionId Int
}
```

Run:

```
npx prisma migrate dev --name rbac_init
```

---

# üîê Middleware

### AuthMiddleware.js

```js
const jwt = require("../utils/jwt");

module.exports = function(req, res, next) {
  try {
    const token = req.headers.authorization?.split(" ")[1];
    if (!token) return res.status(401).json({ error: "Token missing" });

    req.user = jwt.verify(token);
    next();
  } catch {
    return res.status(401).json({ error: "Invalid token" });
  }
};
```

### RoleMiddleware.js

```js
module.exports = function(role) {
  return (req, res, next) => {
    if (!req.user.roles.includes(role))
      return res.status(403).json({ error: "Role denied" });
    next();
  };
};
```

### PermissionMiddleware.js

```js
module.exports = function(permission) {
  return (req, res, next) => {
    if (!req.user.permissions.includes(permission))
      return res.status(403).json({ error: "Permission denied" });
    next();
  };
};
```

---

# üèóÔ∏è Services

* **RoleService.js**

  ```js
  const db = require("../config/db");

  class RoleService {
    async createRole(name) {
      return await db.role.create({ data: { name } });
    }

    async assignPermission(roleId, permissionId) {
      return await db.rolePermission.create({
        data: { roleId, permissionId }
      });
    }
  }

  module.exports = new RoleService();
  ```

* **UserService.js**

  ```js
  const db = require("../config/db");

  class UserService {
    async assignRole(userId, roleId) {
      return await db.userRole.create({ data: { userId, roleId } });
    }
  }

  module.exports = new UserService();
  ```

---

# üõ£Ô∏è Controllers

* **RoleController.js**

  ```js
  const RoleService = require("../services/RoleService");

  class RoleController {
    async create(req, res) {
      const role = await RoleService.createRole(req.body.name);
      res.json(role);
    }

    async assignPermission(req, res) {
      const { roleId, permissionId } = req.body;
      await RoleService.assignPermission(roleId, permissionId);
      res.json({ message: "Permission assigned" });
    }
  }

  module.exports = new RoleController();
  ```

* **UserController.js**

  ```js
  const UserService = require("../services/UserService");

  class UserController {
    async assignRole(req, res) {
      const { userId, roleId } = req.body;
      await UserService.assignRole(userId, roleId);
      res.json({ message: "Role assigned to user" });
    }
  }

  module.exports = new UserController();
  ```

---

# üõ† Routes Example

`role.routes.js`

```js
const router = require("express").Router();
const RoleController = require("../controllers/RoleController");
const auth = require("../middleware/AuthMiddleware");
const roleCheck = require("../middleware/RoleMiddleware");

router.post("/create", auth, roleCheck("admin"), RoleController.create);
router.post("/assign-permission", auth, roleCheck("admin"), RoleController.assignPermission);

module.exports = router;
```

`user.routes.js`

```js
const router = require("express").Router();
const UserController = require("../controllers/UserController");
const auth = require("../middleware/AuthMiddleware");
const roleCheck = require("../middleware/RoleMiddleware");

router.post("/assign-role", auth, roleCheck("admin"), UserController.assignRole);

module.exports = router;
```

---

# ‚úÖ Workflow Example (Admin ‚Üí Role ‚Üí Permission ‚Üí User)

```
ADMIN
  ‚Üì creates role: "manager"
  ‚Üì assigns permissions: create-post, update-post, delete-post
USER #10
  ‚Üì admin assigns role "manager" to user #10
USER #10
  ‚Üì inherits all permissions from "manager"
  ‚Üì can access protected routes like /post/create, /post/delete
```

---

# üî• Summary

* Admin can create **any role**
* Admin can create/assign **permissions to roles**
* Admin can **assign roles to any user**
* Middleware checks **role** or **permission** before accessing route
* Laravel-Spatie like RBAC achieved in **Node.js + MySQL**

---

I can also provide the **full working Node.js project zip** with:

* Auth + JWT
* Admin panel routes
* Role + Permission management
* Assign role to any user
* Protected routes using middleware

Do you want me to do that next?
